<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Flag Party</title>
<link rel="stylesheet" href="/styles.css" />
</head>
<body>
<div class="connection-status" id="connectionStatus">🔴 Déconnecté</div>

<div class="container">
  <h1>🏁 Flag Party</h1>

  <div class="notification" id="notification"></div>

  <!-- Écran d'accueil -->
  <div id="homeScreen" class="screen active">
    <input type="text" id="playerName" placeholder="Votre nom" maxlength="20" />
    <br />
    <button class="btn" onclick="createRoom()">Créer une partie</button>
    <button class="btn btn-secondary" onclick="showJoinRoom()">Rejoindre une partie</button>
  </div>

  <!-- Rejoindre une partie -->
  <div id="joinScreen" class="screen">
    <input type="text" id="roomCode" placeholder="Code de la partie" maxlength="6" />
    <br />
    <button class="btn" onclick="joinRoom()">Rejoindre</button>
    <button class="btn btn-secondary" onclick="goHome()">Retour</button>
  </div>

  <!-- Salle d'attente -->
  <div id="waitingScreen" class="screen">
    <div class="waiting-room">
      <h2>Salle d'attente</h2>
      <div class="room-code" id="roomCodeDisplay"></div>

      <div class="game-mode-selector" id="gameModeSelector">
        <h3>Choisissez le mode de jeu:</h3>
        <div class="game-modes">
          <div class="game-mode-card" data-mode="lefast" onclick="selectGameMode('lefast')">
            <h3><span class="mode-icon">⚡</span> LeFast</h3>
            <p>3 tentatives par question, classement par rapidité !</p>
          </div>
          <div class="game-mode-card" data-mode="ledream" onclick="selectGameMode('ledream')">
            <h3><span class="mode-icon">🌟</span> LeDream</h3>
            <p>QCM avec bonus de rapidité</p>
          </div>
          <div class="game-mode-card" data-mode="lefist" onclick="selectGameMode('lefist')">
            <h3><span class="mode-icon">👊</span> LeFist</h3>
            <p>Cliquez sur le bon continent pour chaque drapeau !</p>
          </div>
          <div class="game-mode-card" data-mode="lerythm" onclick="selectGameMode('lerythm')">
            <h3><span class="mode-icon">🎵</span> LeRythm</h3>
            <p>Tapez la première lettre du pays au bon moment !</p>
          </div>
        </div>
      </div>

      <div class="game-duration-selector" id="gameDurationSelector">
        <label>Durée du jeu:</label>
        <div class="duration-options">
          <div class="duration-btn active" onclick="setGameDuration(30, this)">30s</div>
          <div class="duration-btn" onclick="setGameDuration(60, this)">60s</div>
          <div class="duration-btn" onclick="setGameDuration(90, this)">90s</div>
        </div>
        <div class="ledream-info" id="ledreamInfo" style="display: none;">
          <p style="color: #FFD700; font-style: italic; margin-top: 10px;">
            ⚡ Mode LeDream : Partie en continu jusqu'à ce qu'un joueur atteigne 15000 points !
          </p>
        </div>
        <div class="lefast-info" id="lefastInfo" style="display: none;">
          <p style="color: #FFD700; font-style: italic; margin-top: 10px;">
            🏆 Mode LeFast : Premier à 15000 points ! 3 tentatives par question, 15s par question.
          </p>
        </div>
        <div class="lefist-info" id="lefistInfo" style="display: none;">
          <p style="color: #FFD700; font-style: italic; margin-top: 10px;">
            👊 Mode LeFist : Cliquez sur le bon continent ! 5 erreurs maximum, 30s ou 60s au choix.
          </p>
        </div>
      </div>

      <div class="players-list">
        <h3>Joueurs connectés:</h3>
        <div id="playersList"></div>
      </div>

      <button class="btn" id="startGameBtn" onclick="startGame()" style="display: none;">Commencer la partie</button>
      <button class="btn btn-danger" onclick="leaveRoom()">Quitter</button>
    </div>
  </div>

  <!-- Jeu LeFast - NOUVELLES RÈGLES -->
  <div id="lefastScreen" class="screen">
    <div class="game-info">
      <div class="lefast-attempts-info">
        <div class="attempts-display" id="lefastAttemptsDisplay">Tentatives restantes: 3/3</div>
        <div class="objective">Objectif: 15000 points</div>
      </div>
      <div class="lefast-timer-info">
        <div class="question-timer normal" id="lefastQuestionTimer">15</div>
        <div class="timer-label">secondes</div>
      </div>
      <div class="score-display">Score: <span id="lefastScore">0</span></div>
    </div>

    <div class="flag-container">
      <img id="lefastFlagImage" class="flag-img" src="" alt="Drapeau" />
    </div>

    <div id="lefastBetweenQuestions" class="between-questions" style="display: none;">
      <div class="results-display" id="lefastResultsDisplay"></div>
      <div class="countdown-section">
        <div class="countdown" id="lefastQuestionCountdown"></div>
        <div>Prochaine question dans...</div>
      </div>
    </div>

    <div id="lefastGameContent" class="game-content">
      <input type="text" id="lefastTextInput" placeholder="Nom du pays..." autocomplete="off" />
      <br />
      <button class="btn" onclick="submitLefastAnswer()">Valider</button>
      
      <!-- Historique des tentatives -->
      <div class="lefast-attempts-history" id="lefastAttemptsHistory" style="display: none;"></div>
      
      <div class="lefast-help">
        <p>💡 Vous avez 3 tentatives et 15 secondes par question</p>
      </div>
    </div>
  </div>

  <!-- Jeu LeDream -->
  <div id="ledreamScreen" class="screen">
    <div class="game-info">
      <div class="ledream-timer-container">
        <div class="ledream-timer-bar">
          <div class="ledream-timer-progress" id="ledreamTimerProgress"></div>
        </div>
        <div class="ledream-timer-text" id="ledreamTimer">10</div>
      </div>
      <div class="score-display">Score: <span id="ledreamScore">0</span></div>
    </div>

    <div class="ledream-dashboard" id="ledreamDashboard" style="display: none;">
      <div class="dashboard-players" id="dashboardPlayers"></div>
    </div>

    <div class="flag-container">
      <img id="ledreamFlagImage" class="flag-img" src="" alt="Drapeau" />
    </div>

    <div id="ledreamAnswerInterface" class="ledream-answer-interface">
      <div class="ledream-input-section">
        <input type="text" id="ledreamTextInput" placeholder="Tapez le nom du pays..." autocomplete="off" />
        <div class="ledream-points-indicator">1000 pts</div>
      </div>

      <div class="ledream-help-buttons">
        <button class="btn ledream-help-btn" id="ledreamCarreBtn" onclick="activateLedreamMode('carre')">
          📝 Carré<br /><span class="help-points">500 pts</span>
        </button>
        <button class="btn ledream-help-btn" id="ledreamFiftyBtn" onclick="activateLedreamMode('fifty')">
          ⚡ 50/50<br /><span class="help-points">250 pts</span>
        </button>
      </div>
    </div>

    <div class="answer-options" id="ledreamAnswerOptions" style="display: none;"></div>

    <div id="ledreamFeedback" class="ledream-feedback"></div>
  </div>

  <!-- Jeu LeFist - NOUVEAU CONCEPT -->
  <div id="lefistScreen" class="screen">
    <div class="lefist-game-header">
      <div class="lefist-timer">Temps: <span id="lefistTimer">30</span>s</div>
      <div class="lefist-score">Score: <span id="lefistScore">0</span></div>
      <div class="lefist-stats" id="lefistStatsDisplay">
        <div class="lefist-stat correct">✅ 0</div>
        <div class="lefist-stat incorrect">❌ 0/5</div>
      </div>
    </div>

    <div class="lefist-game-content" id="lefistGameArea">
      <div class="lefist-flag-display">
        <img id="lefistFlagImage" src="" alt="Drapeau" class="lefist-flag-img" />
      </div>

      <div class="lefist-continent-buttons">
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Europe')">
          <div class="continent-image europe-map"></div>
          <span class="continent-name">Europe</span>
        </button>
        
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Asie')">
          <div class="continent-image asia-map"></div>
          <span class="continent-name">Asie</span>
        </button>
        
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Amérique')">
          <div class="continent-image america-map"></div>
          <span class="continent-name">Amérique</span>
        </button>
        
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Afrique')">
          <div class="continent-image africa-map"></div>
          <span class="continent-name">Afrique</span>
        </button>
        
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Océanie')">
          <div class="continent-image oceania-map"></div>
          <span class="continent-name">Océanie</span>
        </button>
        
        <button class="lefist-continent-btn" onclick="handleLefistContinentClick('Autre')">
          <div class="continent-image other-map"></div>
          <span class="continent-name">Autre</span>
        </button>
      </div>
    </div>

    <!-- Écran de fin pour le joueur -->
    <div id="lefistFinishedScreen" class="lefist-finished-screen" style="display: none;">
      <!-- Contenu généré dynamiquement -->
    </div>

    <div id="lefistFeedback" class="lefist-feedback"></div>
  </div>

  <!-- Jeu LeRythm - RHYTHM GAME -->
  <div id="lerythmScreen" class="screen">
    <div class="lerythm-game-container">
      <div class="lerythm-game-header">
        <div class="lerythm-score-display">Score: <span id="lerythmScore">0</span></div>
        <div class="lerythm-combo-display" id="lerythmCombo">Combo x<span id="lerythmComboCount">0</span></div>
      </div>

      <div class="lerythm-multiplier">Multiplicateur: x<span id="lerythmMultiplier">1</span></div>

      <div class="lerythm-lanes" id="lerythmLanes">
        <!-- 8 pistes pour les lettres Q W E R T Y U I -->
        <div class="lerythm-lane" data-lane="0" data-letter="q">
          <div class="lerythm-hit-zone">Q</div>
        </div>
        <div class="lerythm-lane" data-lane="1" data-letter="w">
          <div class="lerythm-hit-zone">W</div>
        </div>
        <div class="lerythm-lane" data-lane="2" data-letter="e">
          <div class="lerythm-hit-zone">E</div>
        </div>
        <div class="lerythm-lane" data-lane="3" data-letter="r">
          <div class="lerythm-hit-zone">R</div>
        </div>
        <div class="lerythm-lane" data-lane="4" data-letter="t">
          <div class="lerythm-hit-zone">T</div>
        </div>
        <div class="lerythm-lane" data-lane="5" data-letter="y">
          <div class="lerythm-hit-zone">Y</div>
        </div>
        <div class="lerythm-lane" data-lane="6" data-letter="u">
          <div class="lerythm-hit-zone">U</div>
        </div>
        <div class="lerythm-lane" data-lane="7" data-letter="i">
          <div class="lerythm-hit-zone">I</div>
        </div>
      </div>

      <div class="lerythm-feedback" id="lerythmFeedback"></div>

      <div class="lerythm-game-over-screen" id="lerythmGameOverScreen" style="display: none;">
        <h2>🎉 Partie Terminée !</h2>
        <div class="lerythm-final-score">Score: <span id="lerythmFinalScore">0</span></div>
        <div class="lerythm-stats">
          <div>Parfait: <span id="lerythmPerfectCount">0</span></div>
          <div>Bien: <span id="lerythmGoodCount">0</span></div>
          <div>OK: <span id="lerythmOkCount">0</span></div>
          <div>Raté: <span id="lerythmMissCount">0</span></div>
          <div>Précision: <span id="lerythmAccuracy">0</span>%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard universel pour tous les modes -->
  <div id="dashboardScreen" class="screen">
    <div class="dashboard-container">
      <h2 id="dashboardTitle">🏆 Classement final</h2>
      <div class="dashboard-ranking" id="dashboardRanking">
        <!-- Classement généré dynamiquement -->
      </div>
      <div class="dashboard-actions">
        <button class="btn btn-secondary" onclick="returnToLobby()">Retour au lobby</button>
        <button class="btn btn-danger" onclick="quitGame()">Quitter</button>
      </div>
    </div>
  </div>

  <!-- Résultats -->
  <div id="resultsScreen" class="screen">
    <h2>🎉 Fin de partie !</h2>
    <div class="players-list">
      <h3>Classement final:</h3>
      <div id="finalRanking"></div>
    </div>
    <button class="btn" onclick="goHome()">Nouvelle partie</button>
  </div>
</div>

<!-- Scripts -->
<script src="/socket.io/socket.io.js"></script>
<script src="/client.js"></script>
</body>
</html>